# Excel to SQLite Importer üöÄ

Una aplicaci√≥n moderna con interfaz gr√°fica para importar datos desde archivos Excel a una base de datos SQLite, con validaciones, animaciones de carga y manejo inteligente de duplicados.

## ‚ú® Caracter√≠sticas

- **Interfaz Gr√°fica Moderna**: Dise√±o minimalista y elegante con CustomTkinter
- **Validaci√≥n Inteligente**: Verifica columnas requeridas y estructura de datos
- **Manejo de Duplicados**: Actualiza registros existentes bas√°ndose en `num_doc`
- **Animaciones de Carga**: Barra de progreso en tiempo real con feedback visual
- **Control de Estado**: Deshabilitaci√≥n autom√°tica de botones durante el procesamiento
- **Estad√≠sticas en Vivo**: Contador de registros en la base de datos
- **Manejo de Errores**: Validaciones robustas con mensajes informativos
- **Multiplataforma**: Compatible con Windows, macOS y Linux

## üõ†Ô∏è Instalaci√≥n

### Opci√≥n 1: Instalaci√≥n Autom√°tica
```bash
# Clonar o descargar los archivos
cd excel_to_sqlite

# Ejecutar script de configuraci√≥n
python setup.py
```

### Opci√≥n 2: Instalaci√≥n Manual
```bash
# Instalar dependencias
pip install -r requirements.txt

# Crear directorios opcionales
mkdir exports samples
```

## üìã Dependencias

- `pandas>=1.5.0` - Procesamiento de datos
- `openpyxl>=3.0.0` - Lectura de archivos Excel
- `customtkinter>=5.0.0` - Interfaz gr√°fica moderna
- `pillow>=9.0.0` - Procesamiento de im√°genes para la UI

## üöÄ Uso

### Interfaz Gr√°fica (Recomendado)
```bash
python src/main.py
```

## üìä Estructura de Datos

### Tabla: `detalle_atenciones`
Campos requeridos en el Excel:
- `num_doc` - N√∫mero de documento (clave √∫nica)
- `fec_doc` - Fecha del documento
- `nh_pac` - N√∫mero de historia del paciente
- `nom_pac` - Nombre del paciente
- `nom_emp` - Nombre de la empresa
- `nom_cia` - Nombre de la compa√±√≠a
- `ta_doc` - Tipo de documento (1 car√°cter)
- `nom_ser` - Nombre del servicio
- `tot_doc` - Total del documento
- `num_fac` - N√∫mero de factura
- `fec_fac` - Fecha de factura
- `num_pag` - N√∫mero de pago
- `fec_pag` - Fecha de pago
- `usu_sis` - Usuario del sistema
- `cod_dx` - C√≥digo de diagn√≥stico
- `facturador` - Facturador
- `producto` - Producto

### Tabla: `seguimiento_facturacion`
Para futuras implementaciones de seguimiento.

## üéØ Funcionalidades de la Interfaz

### Panel Principal
- **Selecci√≥n de Archivo**: Bot√≥n intuitivo para elegir archivos Excel
- **Validaci√≥n Autom√°tica**: Verificaci√≥n en tiempo real de la estructura
- **Barra de Progreso**: Indicador visual del proceso de importaci√≥n
- **Estad√≠sticas**: Contador en vivo de registros en la base de datos

### Controles Inteligentes
- **Deshabilitaci√≥n Autom√°tica**: Los botones se deshabilitan durante el procesamiento
- **Feedback Visual**: Iconos y colores que indican el estado de las operaciones
- **Mensajes Informativos**: Notificaciones claras sobre el progreso y resultados

### Gesti√≥n de Datos
- **Importaci√≥n Inteligente**: Inserta nuevos registros y actualiza existentes
- **Limpieza de Datos**: Conversi√≥n autom√°tica de tipos y manejo de valores nulos
- **Limpieza de Base de Datos**: Opci√≥n para eliminar todos los registros

## üîß Caracter√≠sticas T√©cnicas

### Validaciones
- ‚úÖ Verificaci√≥n de existencia del archivo
- ‚úÖ Validaci√≥n de formato Excel
- ‚úÖ Comprobaci√≥n de columnas requeridas
- ‚úÖ Validaci√≥n de tipos de datos
- ‚úÖ Manejo de valores nulos y vac√≠os

### Procesamiento
- üîÑ Procesamiento as√≠ncrono (no bloquea la interfaz)
- üìä Progreso en tiempo real
- üîç Detecci√≥n de duplicados por `num_doc`
- üîÑ Actualizaci√≥n completa de registros existentes
- üìà Contadores de inserci√≥n, actualizaci√≥n y errores

### Rendimiento
- ‚ö° Procesamiento por lotes para archivos grandes
- üßµ Multihilo para no bloquear la interfaz
- üíæ Uso eficiente de memoria
- üèÉ‚Äç‚ôÇÔ∏è Optimizaci√≥n de consultas SQL

## üêõ Soluci√≥n de Problemas

### Error: "Columnas faltantes"
- Verificar que el Excel tenga todas las columnas requeridas
- Los nombres deben coincidir exactamente (case-sensitive)
- Pueden estar en cualquier orden, pero deben existir

### Error: "No se puede leer el archivo"
- Verificar que el archivo no est√© abierto en Excel
- Comprobar permisos de lectura
- Intentar con un archivo Excel diferente

### Interfaz no responde
- El procesamiento se ejecuta en segundo plano
- Esperar a que termine o reiniciar la aplicaci√≥n
- Verificar que el archivo no sea demasiado grande

### Base de datos bloqueada
- Cerrar otras conexiones a la base de datos
- Reiniciar la aplicaci√≥n
- Verificar permisos de escritura en el directorio

## üìÅ Estructura del Proyecto

```
excel_to_sqlite/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                 # Aplicaci√≥n principal con interfaz gr√°fica
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py           # Configuraci√≥n general y de base de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging_config.py   # Configuraci√≥n de logging
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tipos.py            # Definiciones de tipos (TypedDicts)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ excel_controller.py # Controlador para la l√≥gica de negocio
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py         # Gestor de base de datos (SQLite)
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.py        # Constantes (mensajes, SQL, estilos)
‚îÇ   ‚îî‚îÄ‚îÄ views/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ main_view.py        # Interfaz gr√°fica de usuario (CustomTkinter)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md                   # Este archivo
‚îú‚îÄ‚îÄ requirements.txt            # Dependencias del proyecto
‚îú‚îÄ‚îÄ setup.py                    # Script de instalaci√≥n y configuraci√≥n
‚îú‚îÄ‚îÄ run_app.bat                 # Script para ejecutar en Windows
‚îú‚îÄ‚îÄ logs/                       # Directorio para archivos de log (creado autom√°ticamente)
‚îú‚îÄ‚îÄ exports/                    # Directorio para exportaciones (creado por setup.py)
‚îî‚îÄ‚îÄ samples/                    # Directorio para archivos de muestra (creado por setup.py)
# Nota: facturacion.db se crea dentro de src/core/ por defecto, seg√∫n config.py
```

## üé® Personalizaci√≥n

### Temas
La aplicaci√≥n soporta temas claro y oscuro autom√°ticamente seg√∫n la configuraci√≥n del sistema. Para forzar un tema espec√≠fico, modificar en `src/main.py`:

```python
ctk.set_appearance_mode("dark")   # Tema oscuro
ctk.set_appearance_mode("light")  # Tema claro
ctk.set_appearance_mode("system") # Autom√°tico (por defecto)
```

### Colores
Para cambiar el esquema de colores, modificar en `src/main.py`:

```python
ctk.set_default_color_theme("blue")    # Azul (por defecto)
ctk.set_default_color_theme("green")   # Verde
ctk.set_default_color_theme("dark-blue") # Azul oscuro
```

## üîÑ Flujo de Trabajo

### 1. Preparar Archivo Excel
- Asegurar que contenga todas las columnas requeridas
- Verificar que los datos est√©n en el formato correcto
- Cerrar el archivo si est√° abierto en Excel

### 2. Ejecutar Aplicaci√≥n
```bash
python src/main.py
```

### 3. Importar Datos
1. Hacer clic en "üìÅ Seleccionar Archivo Excel"
2. Elegir el archivo desde el explorador
3. Esperar la validaci√≥n autom√°tica
4. Hacer clic en "üöÄ Importar Datos"
5. Observar el progreso en la barra de carga
6. Revisar el resumen de resultados

### 4. Verificar Resultados
- El contador de registros se actualiza autom√°ticamente
- Revisar mensajes de √©xito o error
- Usar las utilidades de base de datos si es necesario

## üß™ Casos de Uso

### Importaci√≥n Inicial
```python
# Primera vez importando datos
# - Todos los registros se insertar√°n como nuevos
# - Se crear√° la base de datos autom√°ticamente
```

### Actualizaci√≥n de Datos
```python
# Importar archivo con registros existentes
# - Los registros con num_doc existente se actualizar√°n
# - Los nuevos num_doc se insertar√°n
# - Se mantiene la integridad de datos
```

### Limpieza de Base de Datos
```python
# Usar el bot√≥n "üóëÔ∏è Limpiar Base de Datos"
# - Elimina todos los registros
# - Mantiene la estructura de las tablas
# - Requiere confirmaci√≥n del usuario
```

## üìà Monitoreo y Logs

### Informaci√≥n en Tiempo Real
- **Progreso Visual**: Barra de progreso con porcentaje
- **Estado Actual**: Mensaje descriptivo de la operaci√≥n
- **Conteo de Registros**: Estad√≠sticas actualizadas autom√°ticamente

### Resultados Detallados
- **Insertados**: Nuevos registros a√±adidos
- **Actualizados**: Registros existentes modificados
- **Errores**: Filas que no se pudieron procesar

## üõ°Ô∏è Seguridad y Validaci√≥n

### Validaciones de Entrada
- Verificaci√≥n de tipos de archivo
- Validaci√≥n de estructura de datos
- Sanitizaci√≥n de entrada de usuario
- Manejo seguro de rutas de archivo

### Protecci√≥n de Datos
- Transacciones at√≥micas en base de datos
- Rollback autom√°tico en caso de error
- Backup impl√≠cito mediante SQLite
- Confirmaci√≥n para operaciones destructivas

## üöÄ Rendimiento

### Optimizaciones Implementadas
- **Procesamiento As√≠ncrono**: No bloquea la interfaz de usuario
- **Carga por Lotes**: Procesa m√∫ltiples registros eficientemente
- **√çndices de Base de Datos**: B√∫squedas r√°pidas por num_doc
- **Limpieza de Memoria**: Liberaci√≥n autom√°tica de recursos

### Recomendaciones para Archivos Grandes
- **Archivos > 10,000 filas**: El procesamiento puede tomar varios minutos
- **Archivos > 50,000 filas**: Considerar dividir en lotes m√°s peque√±os
- **Memoria RAM**: Asegurar al menos 4GB disponibles para archivos muy grandes

## üîß Configuraci√≥n Avanzada

### Base de Datos Personalizada
Para cambiar la ubicaci√≥n o nombre de la base de datos, modificar las entradas `name` y `DB_PATH` en `src/core/config.py`.

### Timeout de Conexi√≥n
```python
# Configurar timeout para archivos muy grandes
conn = sqlite3.connect(self.db_path, timeout=30.0)
```

## üêõ Debug y Desarrollo

### Modo Desarrollo
```python
# Activar logs detallados
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Testing
```python
# Ejecutar con archivo de prueba
python src/main.py
# Usar archivo en directorio samples/
```

### Logs de Error
Los errores se muestran en:
- Interfaz gr√°fica (messagebox)
- Consola (para desarrollo)
- Barra de progreso (feedback visual)

## üìû Soporte y Contribuci√≥n

### Reportar Problemas
- Incluir versi√≥n de Python
- Adjuntar archivo Excel de ejemplo (sin datos sensibles)
- Describir pasos para reproducir el error
- Incluir mensaje de error completo

### Mejoras Futuras
- [ ] Soporte para CSV
- [ ] Exportaci√≥n a diferentes formatos
- [ ] Configuraci√≥n de mapeo de columnas
- [ ] Historial de importaciones
- [ ] Validaciones de negocio personalizables
- [ ] Interfaz web opcional
- [ ] Soporte para m√∫ltiples bases de datos

## üìù Licencia

Este proyecto est√° disponible bajo licencia MIT. Libre para uso personal y comercial.

## üôè Agradecimientos

- **CustomTkinter**: Por la librer√≠a de interfaz moderna
- **Pandas**: Por el potente procesamiento de datos
- **OpenPyXL**: Por el soporte robusto de Excel
- **SQLite**: Por la base de datos embebida eficiente

---

**¬°Listo para usar! üéâ**

Para cualquier duda o sugerencia, no dudes en contactar o crear un issue en el repositorio.